<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href="common/css/sf.css" rel="stylesheet" type="text/css"/>
<title>Classes: Typeclass Definitions</title>
</head>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/plf.css" rel="stylesheet" type="text/css"/>

<body>

<div id="page">

<div id="header">
<a href='https://www.cis.upenn.edu/~bcpierce/sf/current/index.html'>
<img src='common/media/image/sf_logo_sm.png'></a>
<ul id='menu'>
   <a href='index.html'><li class='section_name'>VMinus Development</li></a>
   <a href='toc.html'><li>Table of Contents</li></a>
   <a href='coqindex.html'><li>Index</li></a>
   <a href='deps.html'><li>Roadmap</li></a>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Classes<span class="subtitle">Typeclass Definitions</span></h1>


<div class="code code-tight">

<br/>
<span class="comment">(*&nbsp;--------------------------------------------------------------------------&nbsp;*<br/>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vellvm&nbsp;-&nbsp;the&nbsp;Verified&nbsp;LLVM&nbsp;project&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Copyright&nbsp;(c)&nbsp;2017&nbsp;Steve&nbsp;Zdancewic&nbsp;&lt;stevez@cis.upenn.edu&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>
&nbsp;*&nbsp;&nbsp;&nbsp;This&nbsp;file&nbsp;is&nbsp;distributed&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>
&nbsp;*&nbsp;&nbsp;&nbsp;License&nbsp;as&nbsp;published&nbsp;by&nbsp;the&nbsp;Free&nbsp;Software&nbsp;Foundation,&nbsp;either&nbsp;version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>
&nbsp;*&nbsp;&nbsp;&nbsp;3&nbsp;of&nbsp;the&nbsp;License,&nbsp;or&nbsp;(at&nbsp;your&nbsp;option)&nbsp;any&nbsp;later&nbsp;version.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>
&nbsp;----------------------------------------------------------------------------&nbsp;*)</span><br/>
</div>

<div class="doc">
<a name="lab4"></a><h1 class="section">Yet another library of typeclasses</h1>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Set</span> <span class="id" type="keyword">Implicit</span> <span class="id" type="var">Arguments</span>.<br/>
<span class="id" type="keyword">Set</span> <span class="id" type="var">Contextual</span> <span class="id" type="keyword">Implicit</span>.<br/>
<span class="id" type="keyword">Global</span> <span class="id" type="var">Generalizable</span> <span class="id" type="var">All</span> <span class="id" type="keyword">Variables</span>.<br/>
<span class="id" type="keyword">Global</span> <span class="id" type="keyword">Set</span> <span class="id" type="var">Automatic</span> <span class="id" type="var">Coercions</span> <span class="id" type="keyword">Import</span>.<br/>
<span class="id" type="var">From</span> <span class="id" type="var">Coq</span> <span class="id" type="keyword">Require</span> <span class="id" type="keyword">Export</span> <span class="id" type="var">Morphisms</span> <span class="id" type="var">RelationClasses</span> <span class="id" type="var">Setoid</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span> <span class="id" type="var">Bool</span> <span class="id" type="var">String</span> <span class="id" type="var">Utf8</span>.<br/>
<span class="id" type="keyword">Export</span> <span class="id" type="var">ListNotations</span>.<br/>
<span class="id" type="var">From</span> <span class="id" type="var">Coq.Program</span> <span class="id" type="keyword">Require</span> <span class="id" type="keyword">Export</span> <span class="id" type="var">Basics</span> <span class="id" type="keyword">Syntax</span>.<br/>
<span class="id" type="var">Arguments</span> <span class="id" type="var">String.append</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> : <span class="id" type="tactic">simpl</span> <span class="id" type="var">never</span>.<br/>
</div>

<div class="doc">
<a name="lab5"></a><h1 class="section">General notations</h1>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Notation</span> "t $ r" := (<span class="id" type="var">t</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 65, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>, <span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "($)" := (Î» <span class="id" type="var">f</span> <span class="id" type="var">x</span>, <span class="id" type="var">f</span> <span class="id" type="var">x</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "($ x )" := (Î» <span class="id" type="var">f</span>, <span class="id" type="var">f</span> <span class="id" type="var">x</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>

<br/>
<span class="id" type="keyword">Infix</span> "âˆ˜" := <span class="id" type="var">compose</span>.<br/>
<span class="id" type="keyword">Notation</span> "(âˆ˜)" := <span class="id" type="var">compose</span> (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "( f âˆ˜)" := (<span class="id" type="var">compose</span> <span class="id" type="var">f</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "(âˆ˜ f )" := (Î» <span class="id" type="var">g</span>, <span class="id" type="var">compose</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
</div>

<div class="doc">
Ensure that <span class="inlinecode"><span class="id" type="tactic">simpl</span></span> unfolds <span class="inlinecode"><span class="id" type="var">id</span></span>, <span class="inlinecode"><span class="id" type="var">compose</span></span>, and <span class="inlinecode"><span class="id" type="var">flip</span></span> when fully
applied. 
</div>
<div class="code code-tight">
<span class="id" type="var">Arguments</span> <span class="id" type="var">id</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> /.<br/>
<span class="id" type="var">Arguments</span> <span class="id" type="var">compose</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> /.<br/>
<span class="id" type="var">Arguments</span> <span class="id" type="var">flip</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> /.<br/>
<span class="id" type="var">Arguments</span> <span class="id" type="var">const</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> /.<br/>
<span class="id" type="keyword">Type</span><span class="id" type="var">classes</span> <span class="id" type="var">Transparent</span> <span class="id" type="var">id</span> <span class="id" type="var">compose</span> <span class="id" type="var">flip</span> <span class="id" type="var">const</span>.<br/>
</div>

<div class="doc">
<a name="lab6"></a><h1 class="section">Setoid Equivalence</h1>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Class</span> <span class="id" type="var">Equiv</span> <span class="id" type="var">A</span> := <span class="id" type="var">equiv</span>: <span class="id" type="var">relation</span> <span class="id" type="var">A</span>.<br/>
<span class="id" type="keyword">Infix</span> "â‰¡" := <span class="id" type="var">equiv</span> (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 70, <span class="id" type="var">no</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "(â‰¡)" := <span class="id" type="var">equiv</span> (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "( X â‰¡)" := (<span class="id" type="var">equiv</span> <span class="id" type="var">X</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "(â‰¡ X )" := (Î» <span class="id" type="var">Y</span>, <span class="id" type="var">Y</span> â‰¡ <span class="id" type="var">X</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "(â‰¢)" := (Î» <span class="id" type="var">X</span> <span class="id" type="var">Y</span>, <span class="id" type="var">Â</span>¬<span class="id" type="var">X</span> â‰¡ <span class="id" type="var">Y</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "X â‰¢ Y":= (<span class="id" type="var">Â</span>¬<span class="id" type="var">X</span> â‰¡ <span class="id" type="var">Y</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 70, <span class="id" type="var">no</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "( X â‰¢)" := (Î» <span class="id" type="var">Y</span>, <span class="id" type="var">X</span> â‰¢ <span class="id" type="var">Y</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "(â‰¢ X )" := (Î» <span class="id" type="var">Y</span>, <span class="id" type="var">Y</span> â‰¢ <span class="id" type="var">X</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>

<br/>
<span class="id" type="keyword">Class</span> <span class="id" type="var">EquivProps</span> <span class="id" type="var">A</span> := {<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">EquivPropsEquiv</span> :&gt; <span class="id" type="var">Equiv</span> <span class="id" type="var">A</span> ;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">EquivPropsEquivalence</span> :&gt; <span class="id" type="var">Equivalence</span> (<span class="id" type="var">EquivPropsEquiv</span>) ;<br/>
}.<br/>
</div>

<div class="doc">
The type class <span class="inlinecode"><span class="id" type="var">LeibnizEquiv</span></span> collects setoid equalities that coincide
with Leibniz equality. We provide the tactic <span class="inlinecode"><span class="id" type="var">fold_leibniz</span></span> to transform such
setoid equalities into Leibniz equalities, and <span class="inlinecode"><span class="id" type="var">unfold_leibniz</span></span> for the
reverse. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Class</span> <span class="id" type="var">LeibnizEquiv</span> <span class="id" type="var">A</span> `{<span class="id" type="var">Equiv</span> <span class="id" type="var">A</span>} := <span class="id" type="var">leibniz_equiv</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> : <span class="id" type="var">x</span> â‰¡ <span class="id" type="var">y</span> â†’ <span class="id" type="var">x</span> = <span class="id" type="var">y</span>.<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">leibniz_equiv_iff</span> `{<span class="id" type="var">LeibnizEquiv</span> <span class="id" type="var">A</span>, !<span class="id" type="var">Reflexive</span> (@<span class="id" type="var">equiv</span> <span class="id" type="var">A</span> <span class="id" type="var">_</span>)} (<span class="id" type="var">x</span> <span class="id" type="var">y</span> : <span class="id" type="var">A</span>) :<br/>
&nbsp;&nbsp;<span class="id" type="var">x</span> â‰¡ <span class="id" type="var">y</span> â†” <span class="id" type="var">x</span> = <span class="id" type="var">y</span>.<br/>
<span class="id" type="keyword">Proof</span>. <span class="id" type="tactic">split</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">leibniz_equiv</span>. <span class="id" type="tactic">intros</span> â†’; <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">fold_leibniz</span> := <span class="id" type="tactic">repeat</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">H</span> : <span class="id" type="var">context</span> [ @<span class="id" type="var">equiv</span> ?<span class="id" type="var">A</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> ] |- <span class="id" type="var">_</span> â‡’<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">setoid_rewrite</span> (<span class="id" type="var">leibniz_equiv_iff</span> (<span class="id" type="var">A</span>:=<span class="id" type="var">A</span>)) <span class="id" type="keyword">in</span> <span class="id" type="var">H</span><br/>
&nbsp;&nbsp;| |- <span class="id" type="var">context</span> [ @<span class="id" type="var">equiv</span> ?<span class="id" type="var">A</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> ] â‡’<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">setoid_rewrite</span> (<span class="id" type="var">leibniz_equiv_iff</span> (<span class="id" type="var">A</span>:=<span class="id" type="var">A</span>))<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">unfold_leibniz</span> := <span class="id" type="tactic">repeat</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">H</span> : <span class="id" type="var">context</span> [ @<span class="id" type="var">eq</span> ?<span class="id" type="var">A</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> ] |- <span class="id" type="var">_</span> â‡’<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">setoid_rewrite</span> &lt;-(<span class="id" type="var">leibniz_equiv_iff</span> (<span class="id" type="var">A</span>:=<span class="id" type="var">A</span>)) <span class="id" type="keyword">in</span> <span class="id" type="var">H</span><br/>
&nbsp;&nbsp;| |- <span class="id" type="var">context</span> [ @<span class="id" type="var">eq</span> ?<span class="id" type="var">A</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> ] â‡’<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">setoid_rewrite</span> &lt;-(<span class="id" type="var">leibniz_equiv_iff</span> (<span class="id" type="var">A</span>:=<span class="id" type="var">A</span>))<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
</div>

<div class="doc">
<a name="lab7"></a><h1 class="section">Equality</h1>
 Introduce some Haskell style like notations. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Notation</span> "(=)" := <span class="id" type="var">eq</span> (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "( x =)" := (<span class="id" type="var">eq</span> <span class="id" type="var">x</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "(= x )" := (Î» <span class="id" type="var">y</span>, <span class="id" type="var">eq</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "(â‰ )" := (Î» <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">x</span> â‰  <span class="id" type="var">y</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "( x â‰ )" := (Î» <span class="id" type="var">y</span>, <span class="id" type="var">x</span> â‰  <span class="id" type="var">y</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "(â‰  x )" := (Î» <span class="id" type="var">y</span>, <span class="id" type="var">y</span> â‰  <span class="id" type="var">x</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Extern</span> 0 (<span class="id" type="var">_</span> = <span class="id" type="var">_</span>) â‡’ <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Extern</span> 100 (<span class="id" type="var">_</span> â‰  <span class="id" type="var">_</span>) â‡’ <span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span>: @<span class="id" type="var">PreOrder</span> <span class="id" type="var">A</span> (=).<br/>
<span class="id" type="keyword">Proof</span>. <span class="id" type="tactic">split</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">congruence</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">equivL</span> {<span class="id" type="var">A</span>} : <span class="id" type="var">Equiv</span> <span class="id" type="var">A</span> := (=).<br/>
</div>

<div class="doc">
A <span class="inlinecode"><span class="id" type="var">Params</span></span> <span class="inlinecode"><span class="id" type="var">f</span></span> <span class="inlinecode"><span class="id" type="var">n</span></span> instance forces the setoid rewriting mechanism not to
rewrite in the first <span class="inlinecode"><span class="id" type="var">n</span></span> arguments of the function <span class="inlinecode"><span class="id" type="var">f</span></span>. We will declare such
instances for all operational type classes in this development. 
</div>
<div class="code code-tight">
<span class="id" type="keyword">Instance</span>: <span class="id" type="var">Params</span> (@<span class="id" type="var">equiv</span>) 2.<br/>
</div>

<div class="doc">
The following instance forces <span class="inlinecode"><span class="id" type="tactic">setoid_replace</span></span> to use setoid equality
(for types that have an <span class="inlinecode"><span class="id" type="var">Equiv</span></span> instance) rather than the standard Leibniz
equality. 
</div>
<div class="code code-tight">
<span class="id" type="keyword">Instance</span> <span class="id" type="var">equiv_default_relation</span> `{<span class="id" type="var">Equiv</span> <span class="id" type="var">A</span>} : <span class="id" type="var">DefaultRelation</span> (â‰¡) | 3.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Extern</span> 0 (<span class="id" type="var">_</span> â‰¡ <span class="id" type="var">_</span>) â‡’ <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Extern</span> 0 (<span class="id" type="var">_</span> â‰¡ <span class="id" type="var">_</span>) â‡’ <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">assumption</span>.<br/>
</div>

<div class="doc">
<a name="lab8"></a><h1 class="section">Type classes</h1>

<div class="paragraph"> </div>

<a name="lab9"></a><h2 class="section">Decidable propositions</h2>
 This type class by (Spitters/van der Weegen, 2011) collects decidable
propositions. For example to declare a parameter expressing decidable equality
on a type <span class="inlinecode"><span class="id" type="var">A</span></span> we write <span class="inlinecode">`{âˆ€</span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">y</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">A</span>,</span> <span class="inlinecode"><span class="id" type="var">Decidable</span></span> <span class="inlinecode">(<span class="id" type="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">y</span>)}</span> and use it by writing
<span class="inlinecode"><span class="id" type="var">decide</span></span> <span class="inlinecode">(<span class="id" type="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">y</span>)</span>. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Class</span> <span class="id" type="var">Decidable</span> (<span class="id" type="var">P</span> : <span class="id" type="keyword">Prop</span>) := <span class="id" type="var">decide</span> : {<span class="id" type="var">P</span>} + {<span class="id" type="var">Â</span>¬<span class="id" type="var">P</span>}.<br/>
<span class="id" type="var">Arguments</span> <span class="id" type="var">decide</span> <span class="id" type="var">_</span> {<span class="id" type="var">_</span>}.<br/>
<span class="id" type="keyword">Notation</span> <span class="id" type="var">eq_dec</span> <span class="id" type="var">A</span> := (âˆ€ <span class="id" type="var">x</span> <span class="id" type="var">y</span> : <span class="id" type="var">A</span>, <span class="id" type="var">Decidable</span> (<span class="id" type="var">x</span> = <span class="id" type="var">y</span>)).<br/>
<span class="id" type="keyword">Notation</span> "x == y" := (<span class="id" type="var">decide</span> (<span class="id" type="var">x</span> = <span class="id" type="var">y</span>)) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 70, <span class="id" type="var">no</span> <span class="id" type="var">associativity</span>).<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">decide_eq_dec</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| [ |- <span class="id" type="var">eq_dec</span> ?<span class="id" type="var">T</span> ] â‡’ <span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">Decidable</span>; <span class="id" type="var">decide</span> <span class="id" type="var">equality</span>; <span class="id" type="var">decide_eq_dec</span><br/>
&nbsp;&nbsp;| [ <span class="id" type="var">H</span>: <span class="id" type="var">eq_dec</span> ?<span class="id" type="var">T</span> |- {?<span class="id" type="var">X</span> = ?<span class="id" type="var">Y</span>} + {?<span class="id" type="var">X</span> â‰  ?<span class="id" type="var">Y</span>} ] â‡’ <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">eq_dec_bool</span> : <span class="id" type="var">eq_dec</span> <span class="id" type="var">bool</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">decide_eq_dec</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">eq_dec_nat</span> : <span class="id" type="var">eq_dec</span> <span class="id" type="var">nat</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">decide_eq_dec</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">eq_dec_string</span> : <span class="id" type="var">eq_dec</span> <span class="id" type="var">string</span> := <span class="id" type="var">string_dec</span>.<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">ZArith.ZArith</span>.<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">eq_dec_z</span> : <span class="id" type="var">eq_dec</span> <span class="id" type="var">Z</span> := <span class="id" type="var">Z_eq_dec</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">eq_dec_pair</span> {<span class="id" type="var">A</span> <span class="id" type="var">B</span>} `(<span class="id" type="var">EA</span>:<span class="id" type="var">eq_dec</span> <span class="id" type="var">A</span>) `(<span class="id" type="var">EB</span>:<span class="id" type="var">eq_dec</span> <span class="id" type="var">B</span>) : <span class="id" type="var">eq_dec</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)%<span class="id" type="var">type</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">decide_eq_dec</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">eq_dec_option</span> {<span class="id" type="var">A</span>} `(<span class="id" type="var">EA</span>:<span class="id" type="var">eq_dec</span> <span class="id" type="var">A</span>) : <span class="id" type="var">eq_dec</span> (<span class="id" type="var">option</span> <span class="id" type="var">A</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">decide_eq_dec</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">eq_dec_list</span> {<span class="id" type="var">A</span>} `(<span class="id" type="var">EA</span>:<span class="id" type="var">eq_dec</span> <span class="id" type="var">A</span>) : <span class="id" type="var">eq_dec</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">decide_eq_dec</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>
</div>

<div class="doc">
<a name="lab10"></a><h2 class="section">Functors</h2>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Class</span> <span class="id" type="var">Functor</span> (<span class="id" type="var">F</span>:<span class="id" type="keyword">Type</span> â†’ <span class="id" type="keyword">Type</span>) := <span class="id" type="var">fmap</span> : âˆ€ {<span class="id" type="var">A</span> <span class="id" type="var">B</span>}, (<span class="id" type="var">A</span> â†’ <span class="id" type="var">B</span>) â†’ <span class="id" type="var">F</span> <span class="id" type="var">A</span> â†’ <span class="id" type="var">F</span> <span class="id" type="var">B</span>.<br/>
<span class="id" type="keyword">Infix</span> "&lt;$&gt;" := <span class="id" type="var">fmap</span> (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 60, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>

<br/>
<span class="id" type="keyword">Class</span> <span class="id" type="var">FunctorLaws</span> (<span class="id" type="var">F</span>:<span class="id" type="keyword">Type</span> â†’ <span class="id" type="keyword">Type</span>) `{<span class="id" type="var">Functor</span> <span class="id" type="var">F</span>} `{<span class="id" type="var">eqiv</span>:âˆ€ <span class="id" type="var">A</span>, <span class="id" type="var">Equiv</span> <span class="id" type="var">A</span>}    :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" type="var">fmap_id</span> : âˆ€ <span class="id" type="var">A</span> (<span class="id" type="var">a</span> : <span class="id" type="var">F</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">id</span> &lt;$&gt; <span class="id" type="var">a</span>) â‰¡ <span class="id" type="var">a</span>;<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="var">fmap_comp</span> : âˆ€ <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">C</span> (<span class="id" type="var">f</span>:<span class="id" type="var">A</span> â†’ <span class="id" type="var">B</span>) (<span class="id" type="var">g</span>:<span class="id" type="var">B</span> â†’ <span class="id" type="var">C</span>) (<span class="id" type="var">a</span>:<span class="id" type="var">F</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">g</span> &lt;$&gt; (<span class="id" type="var">f</span> &lt;$&gt; <span class="id" type="var">a</span>) â‰¡ (<span class="id" type="var">g</span> âˆ˜ <span class="id" type="var">f</span>) &lt;$&gt; <span class="id" type="var">a</span>;<br/>
}.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">option_functor</span> : @<span class="id" type="var">Functor</span> <span class="id" type="var">option</span> := <span class="id" type="var">option_map</span>.<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">option_functor_eq_laws</span> : (@<span class="id" type="var">FunctorLaws</span> <span class="id" type="var">option</span>) <span class="id" type="var">option_functor</span>  (@<span class="id" type="var">eq</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">fmap</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">option_functor</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">option_map</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">fmap</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">option_functor</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">a</span>. <span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>. <span class="comment">(*&nbsp;CHKoh:&nbsp;Originally&nbsp;Qed.&nbsp;*)</span><br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">list_functor</span>: @<span class="id" type="var">Functor</span> <span class="id" type="var">list</span> := <span class="id" type="var">List.map</span>.<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">list_functor_eq_laws</span> : (@<span class="id" type="var">FunctorLaws</span> <span class="id" type="var">list</span>) <span class="id" type="var">list_functor</span> (@<span class="id" type="var">eq</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">apply</span> <span class="id" type="var">List.map_id</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">apply</span> <span class="id" type="var">List.map_map</span>.<br/>
<span class="id" type="keyword">Defined</span>. <span class="comment">(*&nbsp;CHKoh:&nbsp;Originally&nbsp;Qed.&nbsp;*)</span><br/>
</div>

<div class="doc">
<a name="lab11"></a><h2 class="section">Monads</h2>

</div>
<div class="code code-space">
<span class="id" type="keyword">Class</span> <span class="id" type="var">Monad</span> <span class="id" type="var">F</span> `{<span class="id" type="var">Functor</span> <span class="id" type="var">F</span>} :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" type="var">mret</span> : âˆ€ {<span class="id" type="var">A</span>}, <span class="id" type="var">A</span> â†’ <span class="id" type="var">F</span> <span class="id" type="var">A</span> ;<br/>
&nbsp;&nbsp;<span class="id" type="var">mbind</span> : âˆ€ {<span class="id" type="var">A</span> <span class="id" type="var">B</span>}, <span class="id" type="var">F</span> <span class="id" type="var">A</span> â†’ (<span class="id" type="var">A</span> â†’ <span class="id" type="var">F</span> <span class="id" type="var">B</span>) â†’ <span class="id" type="var">F</span> <span class="id" type="var">B</span> ;<br/>
}.<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Unfold</span> <span class="id" type="var">mret</span>.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Unfold</span> <span class="id" type="var">mbind</span>.<br/>

<br/>
<span class="id" type="keyword">Notation</span> "m â‰«= f"  := (<span class="id" type="var">mbind</span> <span class="id" type="var">m</span> <span class="id" type="var">f</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 60, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "( m â‰«=)" := (<span class="id" type="var">mbind</span> <span class="id" type="var">m</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "(â‰«= f )" := (<span class="id" type="keyword">fun</span> <span class="id" type="var">m</span> â‡’ <span class="id" type="var">mbind</span> <span class="id" type="var">m</span> <span class="id" type="var">f</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "(â‰«=)"    := (Î» <span class="id" type="var">m</span> <span class="id" type="var">f</span>, <span class="id" type="var">mbind</span> <span class="id" type="var">m</span> <span class="id" type="var">f</span>) (<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>
<span class="id" type="keyword">Notation</span> "'; y ; z" := (<span class="id" type="var">y</span> â‰«= (Î» <span class="id" type="var">_</span> : (), <span class="id" type="var">z</span>))<br/>
&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 65, <span class="id" type="var">only</span> <span class="id" type="var">parsing</span>, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "' x &lt;- y ; z" := (<span class="id" type="var">y</span> â‰«= (Î» <span class="id" type="var">x</span> : <span class="id" type="var">_</span>, <span class="id" type="var">z</span>))<br/>
&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 65, <span class="id" type="var">x</span> <span class="id" type="var">ident</span>, <span class="id" type="var">only</span> <span class="id" type="var">parsing</span>, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "' ( x<sub>1</sub> , x<sub>2</sub> ) &lt;- y ; z" :=<br/>
&nbsp;&nbsp;(<span class="id" type="var">y</span> â‰«= (Î» <span class="id" type="var">x</span> : <span class="id" type="var">_</span>, <span class="id" type="keyword">let</span> ' (<span class="id" type="var">x<sub>1</sub></span>, <span class="id" type="var">x<sub>2</sub></span>) := <span class="id" type="var">x</span> <span class="id" type="keyword">in</span> <span class="id" type="var">z</span>))<br/>
&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 65, <span class="id" type="var">x<sub>1</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>2</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">only</span> <span class="id" type="var">parsing</span>, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "' ( x<sub>1</sub> , x<sub>2</sub> , x<sub>3</sub> ) &lt;- y ; z" :=<br/>
&nbsp;&nbsp;(<span class="id" type="var">y</span> â‰«= (Î» <span class="id" type="var">x</span> : <span class="id" type="var">_</span>, <span class="id" type="keyword">let</span> ' (<span class="id" type="var">x<sub>1</sub></span>,<span class="id" type="var">x<sub>2</sub></span>,<span class="id" type="var">x<sub>3</sub></span>) := <span class="id" type="var">x</span> <span class="id" type="keyword">in</span> <span class="id" type="var">z</span>))<br/>
&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 65, <span class="id" type="var">x<sub>1</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>2</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>3</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">only</span> <span class="id" type="var">parsing</span>, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "' ( x<sub>1</sub> , x<sub>2</sub> , x<sub>3</sub>  , x<sub>4</sub> ) &lt;- y ; z" :=<br/>
&nbsp;&nbsp;(<span class="id" type="var">y</span> â‰«= (Î» <span class="id" type="var">x</span> : <span class="id" type="var">_</span>, <span class="id" type="keyword">let</span> ' (<span class="id" type="var">x<sub>1</sub></span>,<span class="id" type="var">x<sub>2</sub></span>,<span class="id" type="var">x<sub>3</sub></span>,<span class="id" type="var">x<sub>4</sub></span>) := <span class="id" type="var">x</span> <span class="id" type="keyword">in</span> <span class="id" type="var">z</span>))<br/>
&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 65, <span class="id" type="var">x<sub>1</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>2</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>3</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>4</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">only</span> <span class="id" type="var">parsing</span>, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "' ( x<sub>1</sub> , x<sub>2</sub> , x<sub>3</sub>  , x<sub>4</sub> , x<sub>5</sub> ) &lt;- y ; z" :=<br/>
&nbsp;&nbsp;(<span class="id" type="var">y</span> â‰«= (Î» <span class="id" type="var">x</span> : <span class="id" type="var">_</span>, <span class="id" type="keyword">let</span> ' (<span class="id" type="var">x<sub>1</sub></span>,<span class="id" type="var">x<sub>2</sub></span>,<span class="id" type="var">x<sub>3</sub></span>,<span class="id" type="var">x<sub>4</sub></span>,<span class="id" type="var">x<sub>5</sub></span>) := <span class="id" type="var">x</span> <span class="id" type="keyword">in</span> <span class="id" type="var">z</span>))<br/>
&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 65, <span class="id" type="var">x<sub>1</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>2</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>3</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>4</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>5</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">only</span> <span class="id" type="var">parsing</span>, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "' ( x<sub>1</sub> , x<sub>2</sub> , x<sub>3</sub>  , x<sub>4</sub> , x<sub>5</sub> , x<sub>6</sub> ) &lt;- y ; z" :=<br/>
&nbsp;&nbsp;(<span class="id" type="var">y</span> â‰«= (Î» <span class="id" type="var">x</span> : <span class="id" type="var">_</span>, <span class="id" type="keyword">let</span> ' (<span class="id" type="var">x<sub>1</sub></span>,<span class="id" type="var">x<sub>2</sub></span>,<span class="id" type="var">x<sub>3</sub></span>,<span class="id" type="var">x<sub>4</sub></span>,<span class="id" type="var">x<sub>5</sub></span>,<span class="id" type="var">x<sub>6</sub></span>) := <span class="id" type="var">x</span> <span class="id" type="keyword">in</span> <span class="id" type="var">z</span>))<br/>
&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 65, <span class="id" type="var">x<sub>1</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>2</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>3</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>4</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>5</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">x<sub>6</sub></span> <span class="id" type="var">ident</span>, <span class="id" type="var">only</span> <span class="id" type="var">parsing</span>, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>

<br/>
<span class="id" type="keyword">Class</span> <span class="id" type="var">MonadLaws</span> <span class="id" type="var">F</span> `{<span class="id" type="var">Monad</span> <span class="id" type="var">F</span>} `{<span class="id" type="var">FunctorLaws</span> <span class="id" type="var">F</span>} :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" type="var">mbind_mret</span>  : âˆ€ {<span class="id" type="var">A</span>} (<span class="id" type="var">a</span>: <span class="id" type="var">F</span> <span class="id" type="var">A</span>), (<span class="id" type="var">a</span> â‰«= <span class="id" type="var">mret</span>) â‰¡ <span class="id" type="var">a</span>;<br/>
&nbsp;&nbsp;<span class="id" type="var">mret_mbind</span>  : âˆ€ {<span class="id" type="var">A</span> <span class="id" type="var">B</span>:<span class="id" type="keyword">Type</span>} <span class="id" type="var">a</span> (<span class="id" type="var">f</span>:<span class="id" type="var">A</span> â†’ <span class="id" type="var">F</span> <span class="id" type="var">B</span>), (<span class="id" type="var">mret</span> <span class="id" type="var">a</span>) â‰«= <span class="id" type="var">f</span> â‰¡ (<span class="id" type="var">f</span> <span class="id" type="var">a</span>);<br/>
&nbsp;&nbsp;<span class="id" type="var">mbind_assoc</span> : âˆ€ {<span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">C</span>} (<span class="id" type="var">a</span> : <span class="id" type="var">F</span> <span class="id" type="var">A</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> â†’ <span class="id" type="var">F</span> <span class="id" type="var">B</span>) (<span class="id" type="var">g</span> : <span class="id" type="var">B</span> â†’ <span class="id" type="var">F</span> <span class="id" type="var">C</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">a</span> â‰«= <span class="id" type="var">f</span>) â‰«= <span class="id" type="var">g</span> â‰¡ <span class="id" type="var">a</span> â‰«= (<span class="id" type="keyword">fun</span> <span class="id" type="var">x</span> â‡’ <span class="id" type="var">f</span> <span class="id" type="var">x</span> â‰«= <span class="id" type="var">g</span>);<br/>
}.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">monad_app_fst</span> `{<span class="id" type="var">Monad</span> <span class="id" type="var">F</span>} {<span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">C</span>} (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> â†’ <span class="id" type="var">F</span> <span class="id" type="var">C</span>) (<span class="id" type="var">p</span>:<span class="id" type="var">A</span> * <span class="id" type="var">B</span>) : <span class="id" type="var">F</span> (<span class="id" type="var">C</span> * <span class="id" type="var">B</span>)%<span class="id" type="var">type</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> '(<span class="id" type="var">x</span>,<span class="id" type="var">y</span>) := <span class="id" type="var">p</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;'<span class="id" type="var">z</span> &lt;- <span class="id" type="var">f</span> <span class="id" type="var">x</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">mret</span> (<span class="id" type="var">z</span>,<span class="id" type="var">y</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">monad_app_snd</span> `{<span class="id" type="var">Monad</span> <span class="id" type="var">F</span>} {<span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">C</span>} (<span class="id" type="var">f</span> : <span class="id" type="var">B</span> â†’ <span class="id" type="var">F</span> <span class="id" type="var">C</span>) (<span class="id" type="var">p</span>:<span class="id" type="var">A</span> * <span class="id" type="var">B</span>) : <span class="id" type="var">F</span> (<span class="id" type="var">A</span> * <span class="id" type="var">C</span>)%<span class="id" type="var">type</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> '(<span class="id" type="var">x</span>,<span class="id" type="var">y</span>) := <span class="id" type="var">p</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;'<span class="id" type="var">z</span> &lt;- <span class="id" type="var">f</span> <span class="id" type="var">y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">mret</span> (<span class="id" type="var">x</span>,<span class="id" type="var">z</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">map_monad</span> `{<span class="id" type="var">Monad</span> <span class="id" type="var">F</span>} {<span class="id" type="var">A</span> <span class="id" type="var">B</span>} (<span class="id" type="var">f</span>:<span class="id" type="var">A</span> â†’ <span class="id" type="var">F</span> <span class="id" type="var">B</span>) (<span class="id" type="var">l</span>:<span class="id" type="var">list</span> <span class="id" type="var">A</span>) : <span class="id" type="var">F</span> (<span class="id" type="var">list</span> <span class="id" type="var">B</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">fix</span> <span class="id" type="var">loop</span> <span class="id" type="var">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] â‡’ <span class="id" type="var">mret</span> []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">a</span>::<span class="id" type="var">l'</span> â‡’<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'<span class="id" type="var">b</span> &lt;- <span class="id" type="var">f</span> <span class="id" type="var">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'<span class="id" type="var">bs</span> &lt;- <span class="id" type="var">loop</span> <span class="id" type="var">l'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">mret</span> (<span class="id" type="var">b</span>::<span class="id" type="var">bs</span>)  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">in</span> <span class="id" type="var">loop</span> <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Program Instance</span> <span class="id" type="var">option_monad</span> : (@<span class="id" type="var">Monad</span> <span class="id" type="var">option</span>) <span class="id" type="var">option_functor</span> := <span class="id" type="var">_</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">X</span>. <span class="id" type="tactic">exact</span> (<span class="id" type="var">Some</span> <span class="id" type="var">X</span>).<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">X</span> <span class="id" type="var">X<sub>0</sub></span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">X</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">X<sub>0</sub></span>. <span class="id" type="tactic">exact</span> <span class="id" type="var">a</span>. <span class="id" type="tactic">exact</span> <span class="id" type="var">None</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Program Instance</span> <span class="id" type="var">option_monad_eq_laws</span> : (@<span class="id" type="var">MonadLaws</span> <span class="id" type="var">option</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">a</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Program Instance</span> <span class="id" type="var">list_monad</span> : (@<span class="id" type="var">Monad</span> <span class="id" type="var">list</span>) <span class="id" type="var">list_functor</span> := <span class="id" type="var">_</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">X</span>. <span class="id" type="tactic">exact</span> ([<span class="id" type="var">X</span>]).<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span>. <span class="id" type="tactic">exact</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">l</span> <span class="id" type="var">f</span> â‡’ <span class="id" type="var">flat_map</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Program Instance</span> <span class="id" type="var">list_monad_eq_laws</span> : (@<span class="id" type="var">MonadLaws</span> <span class="id" type="var">list</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">a</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHa</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">app_nil_r</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">a</span>.<br/>
&nbsp;&nbsp;-  <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;-  <span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> (<span class="id" type="tactic">rewrite</span> <span class="id" type="var">flat_map_concat_map</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">concat_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> (<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flat_map_concat_map</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHa</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>
</div>

<div class="doc">
<a name="lab12"></a><h2 class="section">Binary Sums (for informative error messages)</h2>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">sum_map</span> {<span class="id" type="var">X</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span>} (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> â†’ <span class="id" type="var">B</span>) (<span class="id" type="var">s</span>:<span class="id" type="var">X</span> + <span class="id" type="var">A</span>) : <span class="id" type="var">X</span> + <span class="id" type="var">B</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">inl</span> <span class="id" type="var">x</span> â‡’ <span class="id" type="var">inl</span> <span class="id" type="var">x</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">inr</span> <span class="id" type="var">a</span> â‡’ <span class="id" type="var">inr</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Unfold</span> <span class="id" type="var">sum_map</span>.<br/>
<span class="id" type="var">Arguments</span> <span class="id" type="var">sum_map</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> : <span class="id" type="tactic">simpl</span> <span class="id" type="var">nomatch</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">sum_functor</span> {<span class="id" type="var">X</span>:<span class="id" type="keyword">Type</span>} : @<span class="id" type="var">Functor</span> (<span class="id" type="var">sum</span> <span class="id" type="var">X</span>) := (@<span class="id" type="var">sum_map</span> <span class="id" type="var">X</span>).<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">sum_functor_eq_laws</span> {<span class="id" type="var">X</span>:<span class="id" type="keyword">Type</span>} : (@<span class="id" type="var">FunctorLaws</span>(<span class="id" type="var">sum</span> <span class="id" type="var">X</span>)) <span class="id" type="var">sum_functor</span> (@<span class="id" type="var">eq</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">fmap</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">sum_functor</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">sum_map</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">fmap</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">sum_functor</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">a</span>. <span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>. <span class="comment">(*&nbsp;CHKoh:&nbsp;Originally&nbsp;Qed.&nbsp;*)</span><br/>

<br/>
<span class="id" type="keyword">Program Instance</span> <span class="id" type="var">sum_monad</span> {<span class="id" type="var">X</span>:<span class="id" type="keyword">Type</span>} : (@<span class="id" type="var">Monad</span> (<span class="id" type="var">sum</span> <span class="id" type="var">X</span>)) <span class="id" type="var">sum_functor</span> := <span class="id" type="var">_</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">a</span>. <span class="id" type="tactic">exact</span> (<span class="id" type="var">inr</span> <span class="id" type="var">a</span>).<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">x</span> <span class="id" type="var">f</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">x</span>. <span class="id" type="var">left</span>. <span class="id" type="tactic">exact</span> <span class="id" type="var">x</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">f</span>. <span class="id" type="tactic">exact</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Program Instance</span> <span class="id" type="var">sum_monad_eq_laws</span> {<span class="id" type="var">X</span>:<span class="id" type="keyword">Type</span>} : (@<span class="id" type="var">MonadLaws</span> (<span class="id" type="var">sum</span> <span class="id" type="var">X</span>)) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">a</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>
</div>

<div class="doc">
<a name="lab13"></a><h2 class="section">Continuations</h2>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">cont</span> (<span class="id" type="var">A</span>:<span class="id" type="keyword">Type</span>) := (<span class="id" type="var">A</span> â†’ <span class="id" type="var">False</span>) â†’ <span class="id" type="var">False</span>.<br/>

<br/>
<span class="id" type="keyword">Program Instance</span> <span class="id" type="var">cont_functor</span> : (@<span class="id" type="var">Functor</span> <span class="id" type="var">cont</span>).<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">cont</span> <span class="id" type="keyword">in</span> *. <span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">intros</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">X</span> <span class="id" type="keyword">in</span> <span class="id" type="var">X<sub>0</sub></span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H<sub>0</sub></span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">X<sub>0</sub></span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">cont_functor_laws_eq</span> : (@<span class="id" type="var">FunctorLaws</span> <span class="id" type="var">cont</span>) <span class="id" type="var">cont_functor</span> (@<span class="id" type="var">eq</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Program Instance</span> <span class="id" type="var">cont_monad</span> : (@<span class="id" type="var">Monad</span> <span class="id" type="var">cont</span>) <span class="id" type="var">cont_functor</span> := <span class="id" type="var">_</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">cont</span>. <span class="id" type="tactic">exact</span> (<span class="id" type="keyword">fun</span> (<span class="id" type="var">k</span> : <span class="id" type="var">A</span> â†’ <span class="id" type="var">False</span>) â‡’ <span class="id" type="var">k</span> <span class="id" type="var">X</span>).<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">cont</span> <span class="id" type="keyword">in</span> *. <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">f</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">g</span>. <span class="id" type="tactic">exact</span> <span class="id" type="var">a</span>. <span class="id" type="tactic">exact</span> <span class="id" type="var">k</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Program Instance</span> <span class="id" type="var">cont_monad_eq_laws</span> : (@<span class="id" type="var">MonadLaws</span> <span class="id" type="var">cont</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Needs&nbsp;functional&nbsp;extensionality&nbsp;to&nbsp;prove&nbsp;the&nbsp;laws&nbsp;------------------------&nbsp;*)</span><br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">FunctionalExtensionality</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">ST</span> (<span class="id" type="var">M</span>:<span class="id" type="keyword">Type</span>) (<span class="id" type="var">A</span>:<span class="id" type="keyword">Type</span>) := <span class="id" type="var">M</span> â†’ (<span class="id" type="var">M</span> * <span class="id" type="var">A</span>).<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">st_map</span> {<span class="id" type="var">M</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span>} (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> â†’ <span class="id" type="var">B</span>) (<span class="id" type="var">s</span> : <span class="id" type="var">ST</span> <span class="id" type="var">M</span> <span class="id" type="var">A</span>) : <span class="id" type="var">ST</span> <span class="id" type="var">M</span> <span class="id" type="var">B</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> (<span class="id" type="var">m</span>:<span class="id" type="var">M</span>) â‡’<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">m'</span>, <span class="id" type="var">x</span>) := <span class="id" type="var">s</span> <span class="id" type="var">m</span> <span class="id" type="keyword">in</span> (<span class="id" type="var">m'</span>, <span class="id" type="var">f</span> <span class="id" type="var">x</span>).<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">st_ret</span> {<span class="id" type="var">M</span> <span class="id" type="var">A</span>} : <span class="id" type="var">A</span> â†’ <span class="id" type="var">ST</span> <span class="id" type="var">M</span> <span class="id" type="var">A</span> := <span class="id" type="keyword">fun</span> (<span class="id" type="var">x</span>:<span class="id" type="var">A</span>) â‡’ <span class="id" type="keyword">fun</span> (<span class="id" type="var">m</span>: <span class="id" type="var">M</span>) â‡’ (<span class="id" type="var">m</span>, <span class="id" type="var">x</span>).<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Unfold</span> <span class="id" type="var">st_ret</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">st_bind</span> {<span class="id" type="var">M</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span>} : (<span class="id" type="var">ST</span> <span class="id" type="var">M</span> <span class="id" type="var">A</span>) â†’ (<span class="id" type="var">A</span> â†’ <span class="id" type="var">ST</span> <span class="id" type="var">M</span> <span class="id" type="var">B</span>) â†’ <span class="id" type="var">ST</span> <span class="id" type="var">M</span> <span class="id" type="var">B</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> â‡’ <span class="id" type="keyword">fun</span> <span class="id" type="var">f</span> â‡’ <span class="id" type="keyword">fun</span> <span class="id" type="var">m</span> â‡’ <span class="id" type="keyword">let</span> (<span class="id" type="var">m'</span>, <span class="id" type="var">x</span>) := <span class="id" type="var">s</span> <span class="id" type="var">m</span> <span class="id" type="keyword">in</span> <span class="id" type="var">f</span> <span class="id" type="var">x</span> <span class="id" type="var">m'</span>.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Unfold</span> <span class="id" type="var">st_bind</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">st_functor</span> {<span class="id" type="var">M</span>} : (@<span class="id" type="var">Functor</span> (<span class="id" type="var">ST</span> <span class="id" type="var">M</span>)) := (@<span class="id" type="var">st_map</span> <span class="id" type="var">M</span>).<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">st_functor_eq_laws</span> {<span class="id" type="var">M</span>} `{<span class="id" type="var">Equiv</span> <span class="id" type="var">M</span>} : (@<span class="id" type="var">FunctorLaws</span> (<span class="id" type="var">ST</span> <span class="id" type="var">M</span>)) <span class="id" type="var">st_functor</span> (@<span class="id" type="var">eq</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">a</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">fmap</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">st_functor</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">st_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">ST</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">functional_extensionality</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">a</span> <span class="id" type="var">x</span>). <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">C</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">fmap</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">st_functor</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">st_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">functional_extensionality</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">a</span> <span class="id" type="var">x</span>). <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Program Instance</span> <span class="id" type="var">st_monad</span> : âˆ€ <span class="id" type="var">A</span>, (@<span class="id" type="var">Monad</span> (<span class="id" type="var">ST</span> <span class="id" type="var">A</span>)) <span class="id" type="var">st_functor</span> := <span class="id" type="var">_</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span> <span class="id" type="var">A<sub>0</sub></span> <span class="id" type="var">X</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">ST</span>. <span class="id" type="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" type="tactic">intros</span> <span class="id" type="var">A<sub>0</sub></span> <span class="id" type="var">B</span> <span class="id" type="var">X</span> <span class="id" type="var">X<sub>0</sub></span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">ST</span> <span class="id" type="keyword">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">X</span> <span class="id" type="keyword">in</span> <span class="id" type="var">X<sub>1</sub></span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">X<sub>1</sub></span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">b</span>]. <span class="id" type="tactic">apply</span> <span class="id" type="var">X<sub>0</sub></span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Program Instance</span> <span class="id" type="var">st_monad_eq_laws</span> : âˆ€ <span class="id" type="var">A</span>, (@<span class="id" type="var">MonadLaws</span> (<span class="id" type="var">ST</span> <span class="id" type="var">A</span>)) <span class="id" type="var">st_functor</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">functional_extensionality</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span>. <span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">destruct</span> (<span class="id" type="var">a</span> <span class="id" type="var">x</span>). <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>
<span class="id" type="keyword">Next</span> <span class="id" type="keyword">Obligation</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">functional_extensionality</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">a</span> <span class="id" type="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>0</sub></span>).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>
</div>

<div class="doc">
<a name="lab14"></a><h2 class="section">Monads with error</h2>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Class</span> <span class="id" type="var">ExceptionMonad</span> <span class="id" type="var">E</span> <span class="id" type="var">F</span> `{<span class="id" type="var">Monad</span> <span class="id" type="var">F</span>} := <span class="id" type="var">raise</span> : âˆ€ {<span class="id" type="var">A</span>}, <span class="id" type="var">E</span> â†’ <span class="id" type="var">F</span> <span class="id" type="var">A</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">err</span> := <span class="id" type="var">sum</span> <span class="id" type="var">string</span>.<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">err_error</span> : (@<span class="id" type="var">ExceptionMonad</span> <span class="id" type="var">string</span> <span class="id" type="var">err</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) := <span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> (<span class="id" type="var">s</span>:<span class="id" type="var">string</span>) â‡’ <span class="id" type="var">inl</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">trywith</span> {<span class="id" type="var">A</span>:<span class="id" type="keyword">Type</span>} {<span class="id" type="var">F</span>} `{<span class="id" type="var">ExceptionMonad</span> <span class="id" type="var">string</span> <span class="id" type="var">F</span>} (<span class="id" type="var">s</span>:<span class="id" type="var">string</span>) (<span class="id" type="var">o</span>:<span class="id" type="var">option</span> <span class="id" type="var">A</span>) : <span class="id" type="var">F</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">o</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">x</span> â‡’ <span class="id" type="var">mret</span> <span class="id" type="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> â‡’ <span class="id" type="var">raise</span> <span class="id" type="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Unfold</span> <span class="id" type="var">trywith</span>.<br/>
<span class="id" type="var">Arguments</span> <span class="id" type="var">trywith</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> : <span class="id" type="tactic">simpl</span> <span class="id" type="var">nomatch</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">failwith</span> {<span class="id" type="var">A</span>:<span class="id" type="keyword">Type</span>} {<span class="id" type="var">F</span>} `{<span class="id" type="var">ExceptionMonad</span> <span class="id" type="var">string</span> <span class="id" type="var">F</span>} (<span class="id" type="var">s</span>:<span class="id" type="var">string</span>) : <span class="id" type="var">F</span> <span class="id" type="var">A</span> := <span class="id" type="var">raise</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Unfold</span> <span class="id" type="var">failwith</span>.<br/>
<span class="id" type="var">Arguments</span> <span class="id" type="var">failwith</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> : <span class="id" type="tactic">simpl</span> <span class="id" type="var">nomatch</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Monad&nbsp;operations&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;CHKoh:&nbsp;renamed&nbsp;monad_fold_left&nbsp;to&nbsp;monad_fold_right&nbsp;*)</span><br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">monad_fold_right</span> {<span class="id" type="var">A</span> <span class="id" type="var">B</span>} `{<span class="id" type="var">Monad</span> <span class="id" type="var">M</span>} (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> â†’ <span class="id" type="var">B</span> â†’ <span class="id" type="var">M</span> <span class="id" type="var">A</span>) (<span class="id" type="var">l</span>:<span class="id" type="var">list</span> <span class="id" type="var">B</span>) (<span class="id" type="var">a</span>:<span class="id" type="var">A</span>) : <span class="id" type="var">M</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| [] â‡’ <span class="id" type="var">mret</span> <span class="id" type="var">a</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">x</span>::<span class="id" type="var">xs</span> â‡’<br/>
&nbsp;&nbsp;&nbsp;&nbsp;'<span class="id" type="var">y</span> &lt;- <span class="id" type="var">monad_fold_right</span> <span class="id" type="var">f</span> <span class="id" type="var">xs</span> <span class="id" type="var">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">f</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
</div>

<div class="doc">
<a name="lab15"></a><h2 class="section">StringOf</h2>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Class</span> <span class="id" type="var">StringOf</span> (<span class="id" type="var">T</span>:<span class="id" type="keyword">Type</span>) := <span class="id" type="var">string_of</span> : <span class="id" type="var">T</span> â†’ <span class="id" type="var">string</span>.<br/>
<span class="id" type="keyword">Open</span> <span class="id" type="keyword">Scope</span> <span class="id" type="var">string_scope</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">string_of_string</span> : <span class="id" type="var">StringOf</span> <span class="id" type="var">string</span> := <span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> â‡’ <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">string_of_bool</span> : <span class="id" type="var">StringOf</span> <span class="id" type="var">bool</span> := <span class="id" type="keyword">fun</span> (<span class="id" type="var">b</span>:<span class="id" type="var">bool</span>) â‡’ <span class="id" type="keyword">if</span> <span class="id" type="var">b</span> <span class="id" type="keyword">then</span> "true" <span class="id" type="keyword">else</span> "false".<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">string_of_pair</span> {<span class="id" type="var">A</span> <span class="id" type="var">B</span>} `(<span class="id" type="var">SA</span>:<span class="id" type="var">StringOf</span> <span class="id" type="var">A</span>) `(<span class="id" type="var">SB</span>:<span class="id" type="var">StringOf</span> <span class="id" type="var">B</span>) : <span class="id" type="var">StringOf</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)%<span class="id" type="var">type</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">p</span> â‡’ "(" ++ <span class="id" type="var">string_of</span> (<span class="id" type="var">fst</span> <span class="id" type="var">p</span>) ++ ", " ++ <span class="id" type="var">string_of</span> (<span class="id" type="var">snd</span> <span class="id" type="var">p</span>) ++ ")".<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">string_of_option</span> {<span class="id" type="var">A</span>} `(<span class="id" type="var">SA</span>:<span class="id" type="var">StringOf</span> <span class="id" type="var">A</span>) : <span class="id" type="var">StringOf</span> (<span class="id" type="var">option</span> <span class="id" type="var">A</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">opt</span> â‡’ <span class="id" type="keyword">match</span> <span class="id" type="var">opt</span> <span class="id" type="keyword">with</span> <span class="id" type="var">None</span> â‡’ "None" | <span class="id" type="var">Some</span> <span class="id" type="var">x</span> â‡’ "Some " ++ (<span class="id" type="var">string_of</span> <span class="id" type="var">x</span>) <span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">string_of_list_contents</span> {<span class="id" type="var">A</span>} `{<span class="id" type="var">SA</span>:<span class="id" type="var">StringOf</span> <span class="id" type="var">A</span>} (<span class="id" type="var">l</span>:<span class="id" type="var">list</span> <span class="id" type="var">A</span>) : <span class="id" type="var">string</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| [] â‡’ ""<br/>
&nbsp;&nbsp;| <span class="id" type="var">x</span>::[] â‡’ <span class="id" type="var">string_of</span> <span class="id" type="var">x</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">x</span>::<span class="id" type="var">rest</span> â‡’ <span class="id" type="var">string_of</span> <span class="id" type="var">x</span> ++ "; " ++ (<span class="id" type="var">string_of_list_contents</span> <span class="id" type="var">rest</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">string_of_list</span> {<span class="id" type="var">A</span>} `(<span class="id" type="var">SA</span>: <span class="id" type="var">StringOf</span> <span class="id" type="var">A</span>) : <span class="id" type="var">StringOf</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">l</span> â‡’ "[" ++ (string_of_list_contents l) ++ "]".<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">digit_to_string</span> (<span class="id" type="var">x</span>:<span class="id" type="var">Z</span>) : <span class="id" type="var">string</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">x</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Z<sub>0</sub></span> â‡’ "0"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Zpos</span> (1%<span class="id" type="var">positive</span>) â‡’ "1"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Zpos</span> (2%<span class="id" type="var">positive</span>) â‡’ "2"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Zpos</span> (3%<span class="id" type="var">positive</span>) â‡’ "3"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Zpos</span> (4%<span class="id" type="var">positive</span>) â‡’ "4"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Zpos</span> (5%<span class="id" type="var">positive</span>) â‡’ "5"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Zpos</span> (6%<span class="id" type="var">positive</span>) â‡’ "6"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Zpos</span> (7%<span class="id" type="var">positive</span>) â‡’ "7"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Zpos</span> (8%<span class="id" type="var">positive</span>) â‡’ "8"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Zpos</span> (9%<span class="id" type="var">positive</span>) â‡’ "9"<br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span> â‡’ "ERR"<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">to_string_b<sub>10</sub>'</span> <span class="id" type="var">fuel</span> (<span class="id" type="var">x</span>:<span class="id" type="var">Z</span>) : <span class="id" type="var">string</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">fuel</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| 0 â‡’ "ERR: not enough fuel"<br/>
&nbsp;&nbsp;| <span class="id" type="var">S</span> <span class="id" type="var">f</span> â‡’ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">x</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Z<sub>0</sub></span> â‡’ "0"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> â‡’ <span class="id" type="keyword">let</span> '(<span class="id" type="var">q</span>,<span class="id" type="var">r</span>) := (<span class="id" type="var">Z.div_eucl</span> <span class="id" type="var">x</span> 10) <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">q</span> == <span class="id" type="var">Z<sub>0</sub></span> <span class="id" type="keyword">then</span> (<span class="id" type="var">digit_to_string</span> <span class="id" type="var">r</span>) <span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">to_string_b<sub>10</sub>'</span> <span class="id" type="var">f</span> <span class="id" type="var">q</span>) ++ (<span class="id" type="var">digit_to_string</span> <span class="id" type="var">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Definition&nbsp;to_string_b<sub>10</sub>&nbsp;:=&nbsp;to_string_b<sub>10</sub>'&nbsp;10.&nbsp;*)</span><br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">to_string_b<sub>10</sub></span> := <span class="id" type="var">to_string_b<sub>10</sub>'</span> 10000.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">string_of_Z</span> : <span class="id" type="var">StringOf</span> <span class="id" type="var">Z</span> := <span class="id" type="var">to_string_b<sub>10</sub></span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a></div>

</div>

</body>
</html>